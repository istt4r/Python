import numpy as np
import matplotlib.pyplot as plt
from pathlib import Path
from config import WEIGHT_POLY

x = np.array([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388])
y = np.array([77.00,77.50,77.10,77.10,77.10,77.15,77.20,77.25,77.30,77.35,77.40,77.45,77.50,77.55,77.60,77.65,77.70,77.75,77.80,77.85,77.90,77.95,78.00,77.87,77.73,77.60,77.70,77.80,77.90,78.00,78.10,78.07,78.03,78.00,78.40,78.60,78.80,79.00,78.50,78.40,78.45,78.50,78.37,78.23,78.10,78.40,78.56,78.71,78.87,79.03,79.19,79.34,79.50,79.38,79.25,79.13,79.00,79.20,78.20,79.00,79.30,80.30,80.23,80.15,80.08,80.00,80.27,80.53,80.80,80.60,80.40,80.50,80.66,80.82,80.98,81.14,81.30,80.60,81.12,81.63,82.15,82.67,83.18,83.70,83.90,83.05,82.20,82.40,82.10,82.40,81.40,81.63,81.87,82.10,82.00,81.40,82.30,82.85,83.40,83.10,82.80,82.50,82.20,81.90,81.60,81.70,81.65,81.60,81.55,81.50,81.60,81.93,82.25,82.58,82.90,83.10,83.30,83.50,83.70,83.70,83.57,83.43,83.30,83.30,83.57,83.83,84.10,84.00,83.93,83.87,83.80,83.73,83.67,83.60,83.63,83.66,83.69,83.71,83.74,83.77,83.80,83.83,83.86,83.89,83.91,83.94,83.97,84.00,84.00,84.00,84.00,84.00,84.01,84.01,84.01,84.01,84.01,84.01,84.01,84.01,84.01,84.01,84.02,84.02,84.02,84.02,84.02,84.02,84.02,84.02,84.02,84.03,84.03,84.03,84.03,84.03,84.03,84.03,84.03,84.03,84.03,84.04,84.04,84.04,84.04,84.04,84.04,84.04,84.04,84.04,84.04,84.05,84.05,84.05,84.05,84.05,84.05,84.05,84.05,84.05,84.06,84.06,84.06,84.06,84.06,84.06,84.06,84.06,84.06,84.06,84.07,84.07,84.07,84.07,84.07,84.07,84.07,84.07,84.07,84.08,84.08,84.08,84.08,84.08,84.08,84.08,84.08,84.08,84.08,84.09,84.09,84.09,84.09,84.09,84.09,84.09,84.09,84.09,84.09,84.10,84.10,84.10,84.10,84.10,84.03,83.97,83.90,84.03,84.15,84.28,84.40,84.10,84.20,84.30,84.60,84.80,85.00,85.20,85.40,86.40,85.40,85.30,86.50,87.70,86.90,86.50,86.10,86.05,86.00,86.70,86.10,86.10,86.10,86.90,86.60,86.50,87.50,87.10,86.70,87.70,87.47,87.23,87.00,87.50,86.90,86.65,86.40,87.80,88.10,87.50,87.00,86.50,85.40,86.30,87.20,88.10,87.65,87.20,86.10,86.50,86.90,87.30,87.00,87.50,88.70,88.15,87.60,87.55,87.50,87.37,87.23,87.10,86.30,86.78,87.26,87.74,88.22,88.70,88.35,88.00,87.65,87.30,87.32,87.33,87.35,87.36,87.38,87.39,87.41,87.42,87.44,87.45,87.47,87.48,87.50,87.52,87.53,87.55,87.56,87.58,87.59,87.61,87.62,87.64,87.65,87.67,87.68,87.70,87.72,87.73,87.75,87.76,87.78,87.79,87.81,87.82,87.84,87.85,87.87,87.88,87.90,88.10,88.30,88.50,88.70,88.77,88.84,88.91,88.99,89.06,89.13,89.20,89.13,89.07,89.00,89.18,89.36,89.54,89.72,89.90,89.70,89.50,89.17,88.83,88.50,88.87,89.23,89.60])

coefficients = np.polyfit(x, y, 10)

x_range = np.linspace(1, 400, 100)
y_fit = np.polyval(coefficients, x_range)

plt.plot(x, y, 'ro', label='Data Points')
plt.plot(x_range, y_fit, 'b-', label='Line of Best Fit')
plt.xlabel('Days')
plt.ylabel('Weight')
plt.legend()
plt.show()

# Print the coefficients in reverse order (highest degree first)
print("Coefficients:", np.flip(coefficients))

# Calculate the value of the polynomial expression for each x value
y_fit = np.polyval(coefficients, x)

# Calculate the R-squared value
y_mean = np.mean(y)
ss_res = np.sum((y - y_fit) ** 2)
ss_tot = np.sum((y - y_mean) ** 2)
r_squared = 1 - (ss_res / ss_tot)

    
# Open a text file for writing at the specified path
path = Path(WEIGHT_POLY)
with open(path, "w") as file:
    
    #Header labels
    file.write("x, y_data, y_fit\n")
    
    # Write the x values, the y values from the data, and the y values from the polynomial fit to the file
    for i in range(len(x)):
        file.write(str(x[i]) + "," + str(y[i]) + "," + str(y_fit[i]) + "\n")
        
    # Write the R-squared value to the file
    file.write("R-squared: " + str(r_squared))
    
    # Write the coefficients to the file in reverse order (highest degree first)
    file.write("Coefficients: " + str(np.flip(coefficients)) + "\n")
    
    
print("Completed")